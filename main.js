(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-8",headers:{authorization:"515aac65-b974-45c4-ba8b-ae42da887315","Content-Type":"application/json"}},t=function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))};function n(e){var t=document.querySelectorAll(".popup__button");e?t.forEach((function(e){e.textContent="Сохранение..."})):t.forEach((function(e){e.textContent="Сохранить"}))}function o(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}var a=document.querySelector("#card-template").content;function i(e,t,n,o,r,c,i,u){var s=a.querySelector(".card").cloneNode(!0),l=s.querySelector(".card__delete-button"),d=s.querySelector(".card__like-button"),p=s.querySelector(".card__image"),_=s.querySelector(".card__like-vision");return p.src=e.link,p.alt=e.name,s.querySelector(".card__title").textContent=e.name,_.textContent=e.likes.length,e.owner._id!==r?l.remove():l.addEventListener("click",(function(){t(s),c(e._id)})),e.likes.some((function(e){e._id===r?d.classList.add("card__like-button_is-active"):d.classList.remove("card__like-button_is-active")})),d.addEventListener("click",(function(t){t.target.classList.contains("card__like-button_is-active")?u(t,e._id):i(t,e._id),n(d)})),p.addEventListener("click",(function(){o(e)})),s}function u(e){e.classList.toggle("card__like-button_is-active")}function s(e){e.remove()}function l(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.inputErrorActive),o.textContent=""}function d(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){l(e,n,t)}))}function p(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);_(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?l(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.inputErrorActive)}(e,t,t.validationMessage,n)}(e,r,t),_(n,o,t)}))}))}(t,e),d(t,e)}))}function _(e,t,n){(function(e,t){return e.some((function(e){return!e.validity.valid}))})(e)||function(e,t){return e.some((function(e){return e.validity.patternMismatch}))}(e)?(t.disabled=!0,t.classList.add(n.formSubmitInactive)):(t.disabled=!1,t.classList.remove(n.formSubmitInactive))}var f,m=document.querySelector(".places__list"),v=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__add-button"),h=document.querySelectorAll(".popup"),S=document.querySelector(".popup_type_edit"),b=document.querySelector(".popup_type_new-card"),k=document.querySelector(".popup_type_image"),q=k.querySelector(".popup__image"),L=k.querySelector(".popup__caption"),E=document.querySelector(".popup__input_type_name"),g=document.querySelector(".popup__input_type_description"),C=document.querySelector(".profile__image"),x=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),A=document.querySelector(".popup__input_type_card-name"),P=document.querySelector(".popup__input_type_url"),U=document.querySelector(".popup_type_avatar"),w=document.querySelector(".popup__input_type_url-avatar"),T=document.querySelector(".profile__image"),D=document.querySelector(".popup__form"),z=b.querySelector(".popup__form"),I=U.querySelector(".popup__form"),M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",inputErrorActive:"popup__input-error_active",errorClass:"popup__error_visible",formSubmitInactive:"form__submit_inactive"};p(M),h.forEach((function(e){e.classList.add("popup_is-animated")})),v.addEventListener("click",(function(){E.value=x.textContent,g.value=j.textContent,p(M),o(S)})),y.addEventListener("click",(function(){p(M),o(b)})),T.addEventListener("click",(function(){p(M),o(U)})),D.addEventListener("submit",(function(t){var o,c;t.preventDefault(),n(!0),o=E.value,c=g.value,x.textContent=o,j.textContent=c,function(t,o){fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t,about:o})}).finally((function(){n(!1)}))}(x.textContent,j.textContent),D.reset(),E.value=x.textContent,g.value=j.textContent,r(S)})),z.addEventListener("submit",(function(o,c){var a,l;o.preventDefault(),n(!0),(a=A.value,l=P.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:a,link:l,alt:a})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).finally((function(){n(!1)}))).then((function(e){c=e.owner._id;var n=i({name:e.name,link:e.link,alt:e.name,_id:e._id,owner:e.owner,likes:[]},s,u,B,c,t,J,H);m.prepend(n)})),z.reset(),r(b)})),I.addEventListener("submit",(function(t){var o;t.preventDefault(),C.style.backgroundImage="url(".concat(w.value,")"),n(!0),o=w.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).catch((function(e){console.log(e)})).finally((function(){n(!1)})),r(U)}));for(var N=function(e){h[e].addEventListener("click",(function(t){(t.target.classList.contains("popup__close")||t.target.classList.contains("popup"))&&(d(D,M),r(h[e]))}))},O=0;O<h.length;O++)N(O);function B(e){q.src=e.link,q.alt=e.name,L.textContent=e.name,k.classList.add("popup_is-animated"),k.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function J(t,n){var o=t.target,r=t.target.closest(".card").querySelector(".card__like-vision");(function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))})(n).then((function(e){o.classList.add("card__like-button_is-active"),r.textContent=e.likes.length}))}function H(t,n){var o=t.target,r=t.target.closest(".card").querySelector(".card__like-vision");(function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))})(n).then((function(e){o.classList.remove("card__like-button_is-active"),r.textContent=e.likes.length}))}Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:{authorization:e.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:{authorization:e.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))]).then((function(e){f=e[0]._id,x.textContent=e[0].name,j.textContent=e[0].about,C.style.backgroundImage="url(".concat(e[0].avatar,")"),e[1].forEach((function(e){m.append(i(e,s,u,B,f,t,J,H))}))}))})();